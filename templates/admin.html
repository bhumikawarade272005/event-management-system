<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Evento</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --dark: #1a1a2e;
            --darker: #16213e;
            --light: #f8f9fa;
            --gray: #6c757d;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark);
            color: var(--light);
            min-height: 100vh;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--darker);
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .sidebar-header h2 {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .admin-profile {
            text-align: center;
            margin-top: 15px;
        }

        .admin-profile .avatar {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .admin-profile h4 {
            margin-bottom: 5px;
        }

        .admin-profile p {
            color: var(--gray);
            font-size: 0.85rem;
        }

        .sidebar-menu {
            list-style: none;
            margin-top: 20px;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            color: var(--light);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .sidebar-menu a:hover {
            background: rgba(67, 97, 238, 0.1);
            border-left-color: var(--primary);
        }

        .sidebar-menu a.active {
            background: rgba(67, 97, 238, 0.2);
            border-left-color: var(--primary);
            color: var(--primary);
        }

        .sidebar-menu i {
            width: 20px;
            text-align: center;
        }

        .logout-btn {
            margin: 20px;
        }

        .logout-btn a {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            background: var(--danger);
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .logout-btn a:hover {
            background: #c0392b;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }

        .header {
            background: var(--darker);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header h1 {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .current-date {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Stats Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--darker);
            padding: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            background: rgba(67, 97, 238, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .stat-info h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Content Sections */
        .content-section {
            background: var(--darker);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .section-header h2 {
            color: var(--primary);
            font-size: 1.3rem;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th {
            background: rgba(67, 97, 238, 0.2);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--primary);
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        tr:hover {
            background: rgba(255,255,255,0.03);
        }

        /* Status Badges */
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-pending {
            background: rgba(243, 156, 18, 0.2);
            color: #f39c12;
        }

        .status-confirmed {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }

        .status-cancelled {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        .status-completed {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }

        /* Buttons */
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--darker);
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            background: var(--primary);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: white;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 20px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--gray);
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            color: white;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255,255,255,0.15);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Charts */
        .charts-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-container {
            background: var(--darker);
            padding: 20px;
            border-radius: 10px;
            height: 300px;
        }

        /* Flash Messages */
        .flash-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            z-index: 1001;
            min-width: 300px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        .flash-success {
            background: var(--success);
        }

        .flash-error {
            background: var(--danger);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Evento Admin</h2>
                <p>Event Management System</p>
                <div class="admin-profile">
                    <div class="avatar">
                        <i class="fas fa-user-cog"></i>
                    </div>
                    <h4>Administrator</h4>
                    <p>Admin Panel</p>
                </div>
            </div>
            
            <ul class="sidebar-menu">
                <li><a href="#dashboard" class="active" onclick="showSection('dashboard')">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a></li>
                <li><a href="#bookings" onclick="showSection('bookings')">
                    <i class="fas fa-calendar-check"></i> Bookings
                </a></li>
                <li><a href="#users" onclick="showSection('users')">
                    <i class="fas fa-users"></i> Users
                </a></li>
                <!-- NEW: Services -->
                <li><a href="#services" onclick="showSection('services')">
                    <i class="fas fa-concierge-bell"></i> Services
                </a></li>
                <!-- NEW: Halls -->
                <li><a href="#halls" onclick="showSection('halls')">
                    <i class="fas fa-building"></i> Halls
                </a></li>
                <!-- NEW: Packages -->
                <li><a href="#packages" onclick="showSection('packages')">
                    <i class="fas fa-box"></i> Packages
                </a></li>
                <li><a href="#reports" onclick="showSection('reports')">
                    <i class="fas fa-chart-bar"></i> Reports
                </a></li>
            </ul>
            
            <div class="logout-btn">
                <a href="/logout">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1 id="page-title">Admin Dashboard</h1>
                <div class="current-date" id="current-date"></div>
            </div>

            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section">
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-users">{{ total_users }}</h3>
                            <p>Total Users</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-bookings">{{ total_bookings }}</h3>
                            <p>Total Bookings</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="total-revenue">₹{{ "{:,}".format(total_revenue) }}</h3>
                            <p>Total Revenue</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="pending-bookings">{{ pending_bookings }}</h3>
                            <p>Pending Bookings</p>
                        </div>
                    </div>
                </div>

                <div class="section-header">
                    <h2>Recent Bookings</h2>
                    <button class="btn btn-primary" onclick="refreshBookings()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Customer</th>
                                <th>Event Date</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recent-bookings">
                            {% for booking in recent_bookings %}
                            <tr>
                                <td>{{ booking.booking_id }}</td>
                                <td>{{ booking.first_name }} {{ booking.last_name }}</td>
                                <td>{{ booking.event_date.strftime('%Y-%m-%d') if booking.event_date else 'N/A' }}</td>
                                <td>{{ booking.event_type }}</td>
                                <td>₹{{ "{:,}".format(booking.total_amount) if booking.total_amount else 0 }}</td>
                                <td>
                                    <span class="status-badge status-{{ booking.status }}">
                                        {{ booking.status|title }}
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-primary btn-sm" onclick="viewBooking('{{ booking.booking_id }}')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="updateStatus('{{ booking.booking_id }}', 'confirmed')">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Bookings Section -->
            <section id="bookings" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>All Bookings</h2>
                    <div>
                        <select id="status-filter" class="form-control" style="width: auto;" onchange="filterBookings()">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="cancelled">Cancelled</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Customer</th>
                                <th>Email</th>
                                <th>Event Date</th>
                                <th>Type</th>
                                <th>Guests</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="bookings-table">
                            <!-- Bookings loaded via AJAX -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>User Management</h2>
                    <button class="btn btn-primary" onclick="showAddUserModal()">
                        <i class="fas fa-user-plus"></i> Add User
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Admin</th>
                                <th>Bookings</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table">
                            <!-- Users loaded via AJAX -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- NEW: Services Section -->
            <section id="services" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>Service Management</h2>
                    <button class="btn btn-primary" onclick="showAddServiceModal()">
                        <i class="fas fa-plus"></i> Add Service
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Price (₹)</th>
                                <th>Category</th>
                                <th>Active</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="services-table"></tbody>
                    </table>
                </div>
            </section>

            <!-- NEW: Halls Section -->
            <section id="halls" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>Hall Management</h2>
                    <button class="btn btn-primary" onclick="showAddHallModal()">
                        <i class="fas fa-plus"></i> Add Hall
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Location</th>
                                <th>Price (₹)</th>
                                <th>Capacity</th>
                                <th>Active</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="halls-table"></tbody>
                    </table>
                </div>
            </section>

            <!-- NEW: Packages Section -->
            <section id="packages" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>Package Management</h2>
                    <button class="btn btn-primary" onclick="showAddPackageModal()">
                        <i class="fas fa-plus"></i> Add Package
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Price (₹)</th>
                                <th>Features</th>
                                <th>Active</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="packages-table"></tbody>
                    </table>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>Reports & Analytics</h2>
                    <button class="btn btn-primary" onclick="exportReport()">
                        <i class="fas fa-download"></i> Export Report
                    </button>
                </div>
                
                <div class="charts-row">
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container" style="height: 400px;">
                    <canvas id="eventsChart"></canvas>
                </div>
            </section>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New User</h3>
                <button class="modal-close" onclick="closeModal('addUserModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Email Address *</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" class="form-control" name="phone">
                    </div>
                    
                    <div class="form-group">
                        <label>Password *</label>
                        <input type="password" class="form-control" name="password" required>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="is_admin" name="is_admin">
                        <label for="is_admin">Make this user an administrator</label>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-user-plus"></i> Add User
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Booking Modal -->
    <div id="viewBookingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Booking Details</h3>
                <button class="modal-close" onclick="closeModal('viewBookingModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="booking-details">
                    <!-- Booking details loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Add/Edit Service Modal -->
    <div id="serviceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="serviceModalTitle">Add Service</h3>
                <button class="modal-close" onclick="closeModal('serviceModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="serviceForm">
                    <input type="hidden" id="serviceId" name="id">
                    <div class="form-group">
                        <label>Name *</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea class="form-control" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Price (₹) *</label>
                        <input type="number" class="form-control" name="price" required>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <input type="text" class="form-control" name="category">
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="serviceActive" name="is_active" checked>
                        <label for="serviceActive">Active</label>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Save Service</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- NEW: Add/Edit Hall Modal -->
    <div id="hallModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="hallModalTitle">Add Hall</h3>
                <button class="modal-close" onclick="closeModal('hallModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="hallForm">
                    <input type="hidden" id="hallId" name="id">
                    <div class="form-group">
                        <label>Name *</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" class="form-control" name="location">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea class="form-control" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Price (₹) *</label>
                        <input type="number" class="form-control" name="price" required>
                    </div>
                    <div class="form-group">
                        <label>Capacity</label>
                        <input type="number" class="form-control" name="capacity">
                    </div>
                    <div class="form-group">
                        <label>Image URL</label>
                        <input type="url" class="form-control" name="image_url">
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="hallActive" name="is_active" checked>
                        <label for="hallActive">Active</label>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Save Hall</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- NEW: Add/Edit Package Modal -->
    <div id="packageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="packageModalTitle">Add Package</h3>
                <button class="modal-close" onclick="closeModal('packageModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="packageForm">
                    <input type="hidden" id="packageId" name="id">
                    <div class="form-group">
                        <label>Name *</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea class="form-control" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Price (₹) *</label>
                        <input type="number" class="form-control" name="price" required>
                    </div>
                    <div class="form-group">
                        <label>Features (JSON string)</label>
                        <textarea class="form-control" name="features" rows="3" placeholder='["Feature1","Feature2"]'></textarea>
                    </div>
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="packageActive" name="is_active" checked>
                        <label for="packageActive">Active</label>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Save Package</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Flash Messages -->
    <div id="flash-container"></div>

    <script>
        // Initialize date
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        // Show/Hide sections (updated to include new sections)
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Remove active class from all menu items
            document.querySelectorAll('.sidebar-menu a').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).style.display = 'block';
            
            // Add active class to clicked menu item
            event.currentTarget.classList.add('active');
            
            // Update page title
            const titles = {
                'dashboard': 'Admin Dashboard',
                'bookings': 'Booking Management',
                'users': 'User Management',
                'services': 'Service Management',
                'halls': 'Hall Management',
                'packages': 'Package Management',
                'reports': 'Reports & Analytics'
            };
            document.getElementById('page-title').textContent = titles[sectionId];
            
            // Load data for section
            if (sectionId === 'bookings') {
                loadBookings();
            } else if (sectionId === 'users') {
                loadUsers();
            } else if (sectionId === 'services') {
                loadServices();
            } else if (sectionId === 'halls') {
                loadHalls();
            } else if (sectionId === 'packages') {
                loadPackages();
            } else if (sectionId === 'reports') {
                loadReports();
            }
        }

        // Load all bookings (existing)
        async function loadBookings() {
            try {
                showFlash('Loading bookings...', 'success');
                const response = await fetch('/admin/bookings');
                const data = await response.json();
                
                if (data.success) {
                    const tableBody = document.getElementById('bookings-table');
                    tableBody.innerHTML = '';
                    
                    if (data.bookings && data.bookings.length > 0) {
                        data.bookings.forEach(booking => {
                            const row = `
                                <tr>
                                    <td>${booking.booking_id}</td>
                                    <td>${booking.user_name}</td>
                                    <td>${booking.user_email}</td>
                                    <td>${booking.event_date}</td>
                                    <td>${booking.event_type}</td>
                                    <td>${booking.guests}</td>
                                    <td>₹${booking.total_amount.toLocaleString()}</td>
                                    <td>
                                        <span class="status-badge status-${booking.status}">
                                            ${booking.status}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-primary btn-sm" onclick="viewBooking('${booking.booking_id}')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-success btn-sm" onclick="updateStatus('${booking.booking_id}', 'confirmed')">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="btn btn-danger btn-sm" onclick="updateStatus('${booking.booking_id}', 'cancelled')">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                            tableBody.innerHTML += row;
                        });
                        showFlash('Bookings loaded successfully', 'success');
                    } else {
                        tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center;">No bookings found</td></tr>';
                    }
                } else {
                    showFlash(data.message || 'Error loading bookings', 'error');
                }
            } catch (error) {
                console.error('Error loading bookings:', error);
                showFlash('Error loading bookings', 'error');
            }
        }

        // Load all users (existing)
        async function loadUsers() {
            try {
                showFlash('Loading users...', 'success');
                const response = await fetch('/admin/users');
                const data = await response.json();
                
                if (data.success) {
                    const tableBody = document.getElementById('users-table');
                    tableBody.innerHTML = '';
                    
                    if (data.users && data.users.length > 0) {
                        data.users.forEach(user => {
                            const row = `
                                <tr>
                                    <td>${user.id}</td>
                                    <td>${user.name}</td>
                                    <td>${user.email}</td>
                                    <td>${user.phone || 'N/A'}</td>
                                    <td>${user.is_admin ? 'Yes' : 'No'}</td>
                                    <td>${user.bookings_count}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})" ${user.is_admin ? 'disabled' : ''}>
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `;
                            tableBody.innerHTML += row;
                        });
                        showFlash('Users loaded successfully', 'success');
                    } else {
                        tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No users found</td></tr>';
                    }
                } else {
                    showFlash(data.message || 'Error loading users', 'error');
                }
            } catch (error) {
                console.error('Error loading users:', error);
                showFlash('Error loading users', 'error');
            }
        }

        // Filter bookings by status (existing)
        function filterBookings() {
            const filter = document.getElementById('status-filter').value;
            const rows = document.querySelectorAll('#bookings-table tr');
            
            rows.forEach(row => {
                if (row.cells.length > 1) {
                    const statusCell = row.cells[7];
                    if (statusCell) {
                        const statusBadge = statusCell.querySelector('.status-badge');
                        if (statusBadge) {
                            const status = statusBadge.textContent.toLowerCase().trim();
                            if (filter === 'all' || status === filter) {
                                row.style.display = '';
                            } else {
                                row.style.display = 'none';
                            }
                        }
                    }
                }
            });
        }

        // View booking details (existing)
        async function viewBooking(bookingId) {
            try {
                showFlash('Loading booking details...', 'success');
                const response = await fetch(`/admin/view_booking/${bookingId}`);
                const data = await response.json();
                
                if (data.success) {
                    const booking = data.booking;
                    document.getElementById('booking-details').innerHTML = `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 5px;">Booking ID</h4>
                                <p>${booking.booking_id}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 5px;">Status</h4>
                                <span class="status-badge status-${booking.status}">${booking.status}</span>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 5px;">Customer Name</h4>
                                <p>${booking.customer_name}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 5px;">Customer Email</h4>
                                <p>${booking.customer_email}</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 5px;">Event Date</h4>
                                <p>${booking.event_date}</p>
                            </div>
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 5px;">Event Type</h4>
                                <p>${booking.event_type}</p>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: var(--primary); margin-bottom: 10px;">Selected Services</h4>
                            <ul style="list-style: none; padding: 0;">
                                <li>${booking.services.service}</li>
                                <li>${booking.services.hall}</li>
                                <li>${booking.services.package}</li>
                            </ul>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: var(--primary); margin-bottom: 10px;">Total Amount</h4>
                            <p style="font-size: 1.5rem; font-weight: bold;">₹${booking.total_amount.toLocaleString()}</p>
                        </div>
                        
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="btn btn-success" onclick="updateStatus('${booking.booking_id}', 'confirmed')">
                                <i class="fas fa-check"></i> Confirm
                            </button>
                            <button class="btn btn-danger" onclick="updateStatus('${booking.booking_id}', 'cancelled')">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    `;
                    
                    document.getElementById('viewBookingModal').classList.add('active');
                } else {
                    showFlash(data.message, 'error');
                }
            } catch (error) {
                console.error('Error loading booking details:', error);
                showFlash('Error loading booking details', 'error');
            }
        }

        // Update booking status (existing)
        async function updateStatus(bookingId, status) {
            if (!confirm(`Are you sure you want to mark this booking as ${status}?`)) return;
            
            try {
                const response = await fetch('/admin/update_booking_status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        booking_id: bookingId,
                        status: status
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showFlash(`Booking marked as ${status}`, 'success');
                    // Reload current section
                    const activeSection = document.querySelector('.content-section[style="display: block;"]');
                    if (activeSection.id === 'dashboard' || activeSection.id === 'bookings') {
                        loadBookings();
                        // Also refresh dashboard stats
                        if (activeSection.id === 'dashboard') {
                            location.reload();
                        }
                    }
                } else {
                    showFlash(result.message, 'error');
                }
            } catch (error) {
                console.error('Error updating status:', error);
                showFlash('Error updating status', 'error');
            }
        }

        // Show add user modal (existing)
        function showAddUserModal() {
            document.getElementById('addUserModal').classList.add('active');
        }

        // Close modal (updated to accept modal ID)
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Add user form submission (existing)
        document.getElementById('addUserForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                password: formData.get('password'),
                is_admin: document.getElementById('is_admin').checked
            };
            
            try {
                const response = await fetch('/admin/add_user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showFlash('User added successfully', 'success');
                    closeModal('addUserModal');
                    this.reset();
                    loadUsers();
                } else {
                    showFlash(result.message, 'error');
                }
            } catch (error) {
                console.error('Error adding user:', error);
                showFlash('Error adding user', 'error');
            }
        });

        // Delete user (existing)
        async function deleteUser(userId) {
            if (!confirm('Are you sure you want to delete this user? All their bookings will also be deleted.')) return;
            
            try {
                const response = await fetch(`/admin/delete_user/${userId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showFlash('User deleted successfully', 'success');
                    loadUsers();
                } else {
                    showFlash(result.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                showFlash('Error deleting user', 'error');
            }
        }

        // ========== NEW: Services CRUD ==========
        async function loadServices() {
            try {
                const response = await fetch('/admin/services');
                const data = await response.json();
                if (data.success) {
                    const tbody = document.getElementById('services-table');
                    tbody.innerHTML = '';
                    data.services.forEach(s => {
                        const row = `<tr>
                            <td>${s.id}</td>
                            <td>${s.name}</td>
                            <td>${s.description || ''}</td>
                            <td>₹${s.price.toLocaleString()}</td>
                            <td>${s.category || ''}</td>
                            <td>${s.is_active ? 'Yes' : 'No'}</td>
                            <td>
                                <button class="btn btn-primary btn-sm" onclick="editService(${s.id})"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-danger btn-sm" onclick="deleteService(${s.id})"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`;
                        tbody.innerHTML += row;
                    });
                } else {
                    showFlash('Error loading services', 'error');
                }
            } catch (error) {
                console.error('Error loading services:', error);
                showFlash('Error loading services', 'error');
            }
        }

        function showAddServiceModal() {
            document.getElementById('serviceModalTitle').textContent = 'Add Service';
            document.getElementById('serviceForm').reset();
            document.getElementById('serviceId').value = '';
            document.getElementById('serviceModal').classList.add('active');
        }

        async function editService(id) {
            try {
                const response = await fetch('/admin/services');
                const data = await response.json();
                const service = data.services.find(s => s.id === id);
                if (service) {
                    document.getElementById('serviceModalTitle').textContent = 'Edit Service';
                    document.getElementById('serviceId').value = service.id;
                    document.querySelector('#serviceForm [name="name"]').value = service.name;
                    document.querySelector('#serviceForm [name="description"]').value = service.description || '';
                    document.querySelector('#serviceForm [name="price"]').value = service.price;
                    document.querySelector('#serviceForm [name="category"]').value = service.category || '';
                    document.getElementById('serviceActive').checked = service.is_active;
                    document.getElementById('serviceModal').classList.add('active');
                }
            } catch (error) {
                console.error('Error fetching service:', error);
            }
        }

        document.getElementById('serviceForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const id = document.getElementById('serviceId').value;
            const formData = new FormData(this);
            const data = {
                name: formData.get('name'),
                description: formData.get('description'),
                price: parseInt(formData.get('price')),
                category: formData.get('category'),
                is_active: document.getElementById('serviceActive').checked
            };
            const url = id ? `/admin/services/${id}` : '/admin/services';
            const method = id ? 'PUT' : 'POST';
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.success) {
                    showFlash(result.message, 'success');
                    closeModal('serviceModal');
                    loadServices();
                } else {
                    showFlash(result.message, 'error');
                }
            } catch (error) {
                console.error('Error saving service:', error);
                showFlash('Error saving service', 'error');
            }
        });

        async function deleteService(id) {
            if (!confirm('Are you sure you want to delete this service?')) return;
            try {
                const response = await fetch(`/admin/services/${id}`, { method: 'DELETE' });
                const result = await response.json();
                if (result.success) {
                    showFlash(result.message, 'success');
                    loadServices();
                } else {
                    showFlash(result.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting service:', error);
                showFlash('Error deleting service', 'error');
            }
        }

        // ========== NEW: Halls CRUD ==========
        async function loadHalls() {
            try {
                const response = await fetch('/admin/halls');
                const data = await response.json();
                if (data.success) {
                    const tbody = document.getElementById('halls-table');
                    tbody.innerHTML = '';
                    data.halls.forEach(h => {
                        const row = `<tr>
                            <td>${h.id}</td>
                            <td>${h.name}</td>
                            <td>${h.location || ''}</td>
                            <td>₹${h.price.toLocaleString()}</td>
                            <td>${h.capacity || ''}</td>
                            <td>${h.is_active ? 'Yes' : 'No'}</td>
                            <td>
                                <button class="btn btn-primary btn-sm" onclick="editHall(${h.id})"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-danger btn-sm" onclick="deleteHall(${h.id})"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`;
                        tbody.innerHTML += row;
                    });
                } else {
                    showFlash('Error loading halls', 'error');
                }
            } catch (error) {
                console.error('Error loading halls:', error);
                showFlash('Error loading halls', 'error');
            }
        }

        function showAddHallModal() {
            document.getElementById('hallModalTitle').textContent = 'Add Hall';
            document.getElementById('hallForm').reset();
            document.getElementById('hallId').value = '';
            document.getElementById('hallModal').classList.add('active');
        }

        async function editHall(id) {
            try {
                const response = await fetch('/admin/halls');
                const data = await response.json();
                const hall = data.halls.find(h => h.id === id);
                if (hall) {
                    document.getElementById('hallModalTitle').textContent = 'Edit Hall';
                    document.getElementById('hallId').value = hall.id;
                    document.querySelector('#hallForm [name="name"]').value = hall.name;
                    document.querySelector('#hallForm [name="location"]').value = hall.location || '';
                    document.querySelector('#hallForm [name="description"]').value = hall.description || '';
                    document.querySelector('#hallForm [name="price"]').value = hall.price;
                    document.querySelector('#hallForm [name="capacity"]').value = hall.capacity || '';
                    document.querySelector('#hallForm [name="image_url"]').value = hall.image_url || '';
                    document.getElementById('hallActive').checked = hall.is_active;
                    document.getElementById('hallModal').classList.add('active');
                }
            } catch (error) {
                console.error('Error fetching hall:', error);
            }
        }

        document.getElementById('hallForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const id = document.getElementById('hallId').value;
            const formData = new FormData(this);
            const data = {
                name: formData.get('name'),
                location: formData.get('location'),
                description: formData.get('description'),
                price: parseInt(formData.get('price')),
                capacity: parseInt(formData.get('capacity')) || 0,
                image_url: formData.get('image_url'),
                is_active: document.getElementById('hallActive').checked
            };
            const url = id ? `/admin/halls/${id}` : '/admin/halls';
            const method = id ? 'PUT' : 'POST';
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.success) {
                    showFlash(result.message, 'success');
                    closeModal('hallModal');
                    loadHalls();
                } else {
                    showFlash(result.message, 'error');
                }
            } catch (error) {
                console.error('Error saving hall:', error);
                showFlash('Error saving hall', 'error');
            }
        });

        async function deleteHall(id) {
            if (!confirm('Are you sure you want to delete this hall?')) return;
            try {
                const response = await fetch(`/admin/halls/${id}`, { method: 'DELETE' });
                const result = await response.json();
                if (result.success) {
                    showFlash(result.message, 'success');
                    loadHalls();
                } else {
                    showFlash(result.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting hall:', error);
                showFlash('Error deleting hall', 'error');
            }
        }

        // ========== NEW: Packages CRUD ==========
        async function loadPackages() {
            try {
                const response = await fetch('/admin/packages');
                const data = await response.json();
                if (data.success) {
                    const tbody = document.getElementById('packages-table');
                    tbody.innerHTML = '';
                    data.packages.forEach(p => {
                        const row = `<tr>
                            <td>${p.id}</td>
                            <td>${p.name}</td>
                            <td>${p.description || ''}</td>
                            <td>₹${p.price.toLocaleString()}</td>
                            <td>${p.features || ''}</td>
                            <td>${p.is_active ? 'Yes' : 'No'}</td>
                            <td>
                                <button class="btn btn-primary btn-sm" onclick="editPackage(${p.id})"><i class="fas fa-edit"></i></button>
                                <button class="btn btn-danger btn-sm" onclick="deletePackage(${p.id})"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>`;
                        tbody.innerHTML += row;
                    });
                } else {
                    showFlash('Error loading packages', 'error');
                }
            } catch (error) {
                console.error('Error loading packages:', error);
                showFlash('Error loading packages', 'error');
            }
        }

        function showAddPackageModal() {
            document.getElementById('packageModalTitle').textContent = 'Add Package';
            document.getElementById('packageForm').reset();
            document.getElementById('packageId').value = '';
            document.getElementById('packageModal').classList.add('active');
        }

        async function editPackage(id) {
            try {
                const response = await fetch('/admin/packages');
                const data = await response.json();
                const pkg = data.packages.find(p => p.id === id);
                if (pkg) {
                    document.getElementById('packageModalTitle').textContent = 'Edit Package';
                    document.getElementById('packageId').value = pkg.id;
                    document.querySelector('#packageForm [name="name"]').value = pkg.name;
                    document.querySelector('#packageForm [name="description"]').value = pkg.description || '';
                    document.querySelector('#packageForm [name="price"]').value = pkg.price;
                    document.querySelector('#packageForm [name="features"]').value = pkg.features || '';
                    document.getElementById('packageActive').checked = pkg.is_active;
                    document.getElementById('packageModal').classList.add('active');
                }
            } catch (error) {
                console.error('Error fetching package:', error);
            }
        }

        document.getElementById('packageForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const id = document.getElementById('packageId').value;
            const formData = new FormData(this);
            const data = {
                name: formData.get('name'),
                description: formData.get('description'),
                price: parseInt(formData.get('price')),
                features: formData.get('features'),
                is_active: document.getElementById('packageActive').checked
            };
            const url = id ? `/admin/packages/${id}` : '/admin/packages';
            const method = id ? 'PUT' : 'POST';
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.success) {
                    showFlash(result.message, 'success');
                    closeModal('packageModal');
                    loadPackages();
                } else {
                    showFlash(result.message, 'error');
                }
            } catch (error) {
                console.error('Error saving package:', error);
                showFlash('Error saving package', 'error');
            }
        });

        async function deletePackage(id) {
            if (!confirm('Are you sure you want to delete this package?')) return;
            try {
                const response = await fetch(`/admin/packages/${id}`, { method: 'DELETE' });
                const result = await response.json();
                if (result.success) {
                    showFlash(result.message, 'success');
                    loadPackages();
                } else {
                    showFlash(result.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting package:', error);
                showFlash('Error deleting package', 'error');
            }
        }

        // Load reports (existing)
        async function loadReports() {
            try {
                showFlash('Loading reports...', 'success');
                const response = await fetch('/admin/reports');
                const data = await response.json();
                
                if (data.success) {
                    // Revenue Chart
                    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
                    new Chart(revenueCtx, {
                        type: 'line',
                        data: {
                            labels: data.monthly_revenue.map(r => r.month),
                            datasets: [{
                                label: 'Monthly Revenue (₹)',
                                data: data.monthly_revenue.map(r => r.revenue),
                                borderColor: '#4361ee',
                                backgroundColor: 'rgba(67, 97, 238, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Monthly Revenue Trend',
                                    color: '#fff'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255,255,255,0.1)'
                                    },
                                    ticks: {
                                        color: '#ccc',
                                        callback: function(value) {
                                            return '₹' + value.toLocaleString();
                                        }
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255,255,255,0.1)'
                                    },
                                    ticks: {
                                        color: '#ccc'
                                    }
                                }
                            }
                        }
                    });

                    // Status Chart
                    const statusCtx = document.getElementById('statusChart').getContext('2d');
                    new Chart(statusCtx, {
                        type: 'doughnut',
                        data: {
                            labels: data.status_distribution.map(s => s.status),
                            datasets: [{
                                data: data.status_distribution.map(s => s.count),
                                backgroundColor: [
                                    '#f39c12',
                                    '#2ecc71',
                                    '#e74c3c',
                                    '#3498db'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Booking Status Distribution',
                                    color: '#fff'
                                },
                                legend: {
                                    labels: {
                                        color: '#ccc'
                                    }
                                }
                            }
                        }
                    });

                    // Events Chart
                    const eventsCtx = document.getElementById('eventsChart').getContext('2d');
                    new Chart(eventsCtx, {
                        type: 'bar',
                        data: {
                            labels: data.event_types.map(e => e.type),
                            datasets: [{
                                label: 'Number of Events',
                                data: data.event_types.map(e => e.count),
                                backgroundColor: '#4361ee',
                                borderColor: '#3a56d4',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Events by Type',
                                    color: '#fff'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255,255,255,0.1)'
                                    },
                                    ticks: {
                                        color: '#ccc'
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255,255,255,0.1)'
                                    },
                                    ticks: {
                                        color: '#ccc'
                                    }
                                }
                            }
                        }
                    });
                    
                    showFlash('Reports loaded successfully', 'success');
                } else {
                    showFlash(data.message || 'Error loading reports', 'error');
                }
            } catch (error) {
                console.error('Error loading reports:', error);
                showFlash('Error loading reports', 'error');
            }
        }

        // Export report (existing)
        function exportReport() {
            showFlash('Exporting report...', 'success');
            setTimeout(() => {
                showFlash('Report exported successfully!', 'success');
            }, 1000);
        }

        // Refresh bookings (existing)
        function refreshBookings() {
            loadBookings();
        }

        // Show flash message (existing)
        function showFlash(message, type) {
            const container = document.getElementById('flash-container');
            const flash = document.createElement('div');
            flash.className = `flash-message flash-${type}`;
            flash.textContent = message;
            container.appendChild(flash);
            
            setTimeout(() => {
                flash.remove();
            }, 5000);
        }

        // Check admin access on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Verify admin access
            fetch('/check_login')
                .then(response => response.json())
                .then(data => {
                    if (!data.logged_in || !data.is_admin) {
                        window.location.href = '/login';
                    }
                });
            
            // Load initial data for dashboard
            loadBookings();
            loadUsers();
            // Optionally preload other sections? Not needed until visited.
        });
    </script>
</body>
</html>